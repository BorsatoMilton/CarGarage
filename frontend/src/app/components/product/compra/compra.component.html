<div class="page-container container-fluid py-3 py-md-4">
  <app-universal-alert></app-universal-alert>
  <div class="vehicle-container card shadow-lg">
    <div class="row g-3 g-md-4">
      

      <div class="col-12 col-md-6">
        <div class="card h-100">
          <div class="card-body p-0">
            <div class="image-carousel">
              <div class="carousel-container" *ngIf="(vehiculo?.imagenes?.length ?? 0) > 0">
                <div class="carousel-slide" 
                     *ngFor="let imagen of vehiculo?.imagenes; let i = index"
                     [class.active]="i === currentSlideIndex">
                  <img [src]="'http://localhost:3000/uploads/' + imagen" 
                       alt="Imagen del vehículo"
                       class="carousel-image img-fluid">
                </div>

                <button class="carousel-control prev" (click)="previousSlide()">&#10094;</button>
                <button class="carousel-control next" (click)="nextSlide()">&#10095;</button>

                <div class="carousel-indicators">
                  <span *ngFor="let imagen of vehiculo?.imagenes; let i = index" 
                        [class.active]="i === currentSlideIndex"
                        (click)="goToSlide(i)"></span>
                </div>
              </div>

              <div *ngIf="!vehiculo?.imagenes?.length" class="no-images text-center p-4">
                <i class="bi bi-image fs-1 text-muted"></i>
                <p class="text-muted mt-2">No hay imágenes disponibles</p>
              </div>
            </div>
          </div>
        </div>
      </div>


      <div class="col-12 col-md-6">
        <div class="card h-100">
          <div class="card-body p-3 p-md-4">
            <h2 class="card-title mb-3 mb-md-4 fw-bold text-primary h4">{{vehiculo?.modelo}}</h2>
            
 
            <div class="vehicle-specs mb-4 mb-md-5">
              <h4 class="section-title mb-2 mb-md-3 h5">
                <i class="bi bi-card-checklist me-2"></i>Especificaciones
              </h4>
              <dl class="row">
                <dt class="col-5 col-md-4">Categoría</dt>
                <dd class="col-7 col-md-8">{{vehiculo?.categoria?.nombreCategoria}}</dd>

                <dt class="col-5 col-md-4">Marca</dt>
                <dd class="col-7 col-md-8">{{vehiculo?.marca?.nombreMarca}}</dd>

                <dt class="col-5 col-md-4">Transmisión</dt>
                <dd class="col-7 col-md-8 text-capitalize">{{vehiculo?.transmision}}</dd>

                <dt class="col-5 col-md-4">Precio Venta</dt>
                <dd class="col-7 col-md-8 fw-bold text-success">{{ vehiculo?.precioVenta | currency:'ARS':'symbol':'1.0-0' }}</dd>

                <dt class="col-5 col-md-4">Alquiler Diario</dt>
                <dd class="col-7 col-md-8 fw-bold text-info">{{ vehiculo?.precioAlquilerDiario | currency:'ARS':'symbol':'1.0-0' }}</dd>
              </dl>
            </div>

    
            <div class="owner-info mb-4 mb-md-5">
              <h4 class="section-title mb-2 mb-md-3 h5">
                <i class="bi bi-person-badge me-2"></i>Propietario
              </h4>
              <dl class="row">
                <dt class="col-5 col-md-4">Nombre</dt>
                <dd class="col-7 col-md-8">{{vehiculo?.propietario?.nombre}} {{vehiculo?.propietario?.apellido}}</dd>

                <dt class="col-5 col-md-4">Contacto</dt>
                <dd class="col-7 col-md-8">
                  <a href="mailto:{{vehiculo?.propietario?.mail}}" class="text-decoration-none">
                    <i class="bi bi-envelope me-2"></i>{{vehiculo?.propietario?.mail}}
                  </a>
                </dd>

                <dt class="col-5 col-md-4">Teléfono</dt>
                <dd class="col-7 col-md-8">
                  <i class="bi bi-telephone me-2"></i>{{vehiculo?.propietario?.telefono || 'No disponible'}}
                </dd>

                <dt class="col-5 col-md-4">Ubicación</dt>
                <dd class="col-7 col-md-8">
                  <i class="bi bi-geo-alt me-2"></i>{{vehiculo?.propietario?.direccion || 'No especificada'}}
                </dd>
              </dl>
            </div>

    
            <div *ngIf="vehiculo?.compra" class="status-alerts mb-4">
              <div *ngIf="vehiculo?.compra?.estadoCompra === 'PENDIENTE'" 
                   class="alert alert-warning d-flex align-items-center py-2">
                <i class="bi bi-exclamation-triangle me-2"></i>
                <div class="small">Vehículo reservado - Pendiente de confirmación</div>
              </div>

              <div *ngIf="vehiculo?.compra?.estadoCompra === 'CONFIRMADA'" 
                   class="alert alert-success d-flex align-items-center py-2">
                <i class="bi bi-check-circle me-2"></i>
                <div class="small">Vehículo vendido - Transacción completada</div>
              </div>
            </div>

       
            <div class="d-grid gap-2 mt-3 mt-md-4">
              <button type="button" 
                      class="btn btn-primary fw-bold py-2 py-md-3"
                      (click)="openModal('comprar')"
                      [disabled]="vehiculo?.compra?.estadoCompra === 'PENDIENTE' || vehiculo?.compra?.estadoCompra === 'CONFIRMADA' || vehiculo?.compra?.estadoCompra === 'FINALIZADA'">
                <i class="bi bi-currency-dollar me-2"></i>
                <span class="small">
                  {{ vehiculo?.precioVenta ? ('Comprar por ' + (vehiculo?.precioVenta | currency:'ARS':'symbol':'1.0-0')) : 'Solicitar compra' }}
                </span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div id="comprar" class="modalChanged">
  <div class="modal-contentChanged">
    <span class="close" (click)="closeModal('comprar')">&times;</span>
    <h2 class="h5 mb-3">Comprar Vehiculo</h2>
    <div class="mb-3">
      <p>¿Estás seguro de comprar este vehículo?</p>
      <p class="fw-bold">{{ vehiculo?.modelo }}</p>
    </div>
    <div class="d-flex gap-2 justify-content-end">
      <button class="btn btn-secondary btn-sm" (click)="closeModal('comprar')">Cancelar</button>
      <button class="btn btn-success btn-sm" (click)="comprar()">Confirmar</button>
    </div>
  </div>
</div>